<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uno Com Escada Simulator 95</title>
    <style>
        body{
            width: 100vw;
            height: 100svh;
            overflow:hidden;
            display: flex;
            align-items: center;
            padding: 0;
            margin: 0;
        }
        #myCanvas{
            height: 100%;
            margin-left: auto;
            margin-right: auto;
            image-rendering: pixelated;
        }
    </style>
  <script type="module" crossorigin>
var V=Object.defineProperty;var H=(s,t,e)=>t in s?V(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var r=(s,t,e)=>(H(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const k=12,q=8;class R{constructor({center:t,radius:e,from:o,to:i,prev:n,width:h}){r(this,"center");r(this,"radius");r(this,"from");r(this,"to");r(this,"prev");r(this,"next");r(this,"width");r(this,"length",0);r(this,"segments",0);r(this,"vertices",[]);r(this,"aabb",[]);r(this,"waypoints",[]);r(this,"clockwise",!0);for(i<0&&(this.clockwise=!1);o>2;)o-=2;for(;o<0;)o+=2;this.center=t,this.radius=e,this.from=o,this.to=i,this.prev=n,this.length=this.radius*Math.abs(this.to)*Math.PI,this.segments=Math.max(4,this.length/k|0),this.width=h,this.generateWaypoints(),this.generateVertices(),this.aabb=this.getAABB()}generateVertices(){const t=Math.max(2,this.length/k|0),e=this.to/t,[o,i]=this.center;for(let n=0;n<=t;n++)this.vertices.push([o+Math.cos((this.from+e*n)*Math.PI)*(this.radius-this.width/2),i+Math.sin((this.from+e*n)*Math.PI)*(this.radius-this.width/2)]);for(let n=t;n>=0;n--)this.vertices.push([o+Math.cos((this.from+e*n)*Math.PI)*(this.radius+this.width/2),i+Math.sin((this.from+e*n)*Math.PI)*(this.radius+this.width/2)])}generateWaypoints(){const t=Math.max(2,this.length/q|0),e=this.to/t;this.waypoints.push(this.startPoint);const[o,i]=this.center;for(let n=1;n<t;n++)this.waypoints.push([o+Math.cos((this.from+e*n)*Math.PI)*this.radius,i+Math.sin((this.from+e*n)*Math.PI)*this.radius]);this.waypoints.push(this.endPoint)}get endPoint(){const[t,e]=this.center,o=t+this.radius*Math.cos((this.from+this.to)*Math.PI),i=e+this.radius*Math.sin((this.from+this.to)*Math.PI);return[o,i]}get endPointLeft(){const[t,e]=this.center;return[t+(this.radius+this.width/2)*Math.cos((this.from+this.to)*Math.PI),e+(this.radius+this.width/2)*Math.sin((this.from+this.to)*Math.PI)]}get endPointRight(){const[t,e]=this.center;return[t+(this.radius-this.width/2)*Math.cos((this.from+this.to)*Math.PI),e+(this.radius-this.width/2)*Math.sin((this.from+this.to)*Math.PI)]}get startPointRight(){const[t,e]=this.center;return[t+(this.radius-this.width/2)*Math.cos(this.from*Math.PI),e+(this.radius-this.width/2)*Math.sin(this.from*Math.PI)]}get startPoint(){const[t,e]=this.center,o=t+this.radius*Math.cos(this.from*Math.PI),i=e+this.radius*Math.sin(this.from*Math.PI);return[o,i]}get startPointLeft(){const[t,e]=this.center;return[t+(this.radius+this.width/2)*Math.cos(this.from*Math.PI),e+(this.radius+this.width/2)*Math.sin(this.from*Math.PI)]}getAABB(){const t=[this.startPointLeft,this.startPointRight,this.endPointLeft,this.endPointRight];let e=t[0][0],o=t[0][1],i=t[0][0],n=t[0][1];for(const h of t)h[0]<e&&(e=h[0]),h[0]>i&&(i=h[0]),h[1]<o&&(o=h[1]),h[1]>n&&(n=h[1]);return[e,o,i-e,n-o]}closestPoint(t,e){const o=t-this.center[0],i=e-this.center[1],n=Math.atan2(i,o);return[this.center[0]+this.radius*Math.cos(n),this.center[1]+this.radius*Math.sin(n)]}lookAhead(t,e){let o=t-this.center[0],i=e-this.center[1];const n=Math.sqrt(o*o+i*i);return o/=n,i/=n,this.to<0&&(o*=-1,i*=-1),[-i,o]}continue({radius:t,to:e}){const o=Math.cos((this.from+this.to)*Math.PI),i=Math.sin((this.from+this.to)*Math.PI),n=[this.center[0]+o*(this.radius+(Math.sign(this.to)!==Math.sign(e)?t:-t)),this.center[1]+i*(this.radius+(Math.sign(this.to)!==Math.sign(e)?t:-t))];let h=this.from+this.to,M=e;Math.sign(this.to)!==Math.sign(e)&&(h+=1);const p=new R({center:n,radius:t,from:h,to:M,prev:this,width:this.width});return this.next=p,p}drawAsphalt(t,e){t.save(),t.beginPath(),this.clockwise?t.fillStyle="#555555":t.fillStyle="#646464",t.moveTo(...e.translate(this.vertices[0]));const o=this.vertices.length;for(let i=1;i<o;i++)t.lineTo(...e.translate(this.vertices[i]));t.closePath(),t.fill(),t.restore()}draw(t,e){this.drawAsphalt(t,e)}}function S(s,t,e){return s<t?t:s>e?e:s}function z(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}class D{constructor(){r(this,"eBrake",0);r(this,"throttle",0);r(this,"brake",0);r(this,"left",0);r(this,"right",0)}}function $(s){return{gravity:9.81,mass:1200,inertiaScale:1,halfWidth:.8,cgToFront:2,cgToRear:2,cgToFrontAxle:1.25,cgToRearAxle:1.25,cgHeight:.55,wheelRadius:.3,wheelWidth:.2,tireGrip:2,lockGrip:.7,engineForce:8e3,brakeForce:12e3,eBrakeForce:12e3/2.5,weightTransfer:.2,maxSteer:.6,cornerStiffnessFront:5,cornerStiffnessRear:5.2,airResist:2.5,rollResist:8,...s}}class K{constructor(t){r(this,"heading",0);r(this,"position",[0,0]);r(this,"velocity",[0,0]);r(this,"velocity_c",[0,0]);r(this,"accel",[0,0]);r(this,"accel_c",[0,0]);r(this,"absVel",0);r(this,"yawRate",0);r(this,"steer",0);r(this,"steerAngle",0);r(this,"input",new D);r(this,"smoothSteer",!0);r(this,"safeSteer",!0);r(this,"inertia",0);r(this,"wheelBase",0);r(this,"axleWeightRatioFront",0);r(this,"axleWeightRatioRear",0);r(this,"config",{});if(!t)throw"cade o config?";this.config=$(t),this.inertia=this.config.mass*this.config.inertiaScale,this.wheelBase=this.config.cgToFrontAxle+this.config.cgToRearAxle,this.axleWeightRatioFront=this.config.cgToRearAxle/this.wheelBase,this.axleWeightRatioRear=this.config.cgToFrontAxle/this.wheelBase;let e=this.config;console.log(-e.cgToRear,-e.halfWidth,e.cgToFront+e.cgToRear,e.halfWidth*2)}draw(t,e){const o=this.config;t.save(),t.translate(...e.translate(this.position)),t.rotate(this.heading),t.fillStyle="pink",t.scale(e.zoom,e.zoom),t.fillRect(-o.cgToRear,-o.halfWidth,o.cgToFront+o.cgToRear,o.halfWidth*2),t.restore(),t.save(),t.fillStyle="black",t.font="48px serif",t.fillText(`${(this.absVel*3.6).toFixed(2)}km/h`,20,80),t.restore()}update(t){this.doSteering();const e=this.config,o=Math.sin(this.heading),i=Math.cos(this.heading);this.velocity_c[0]=i*this.velocity[0]+o*this.velocity[1],this.velocity_c[1]=i*this.velocity[1]-o*this.velocity[0];const n=e.mass*(this.axleWeightRatioFront*e.gravity-e.weightTransfer*this.accel_c[0]*e.cgHeight/this.wheelBase),h=e.mass*(this.axleWeightRatioRear*e.gravity+e.weightTransfer*this.accel_c[0]*e.cgHeight/this.wheelBase),M=e.cgToFrontAxle*this.yawRate,p=-e.cgToRearAxle*this.yawRate,C=Math.atan2(this.velocity_c[1]+M,Math.abs(this.velocity_c[0]))-Math.sign(this.velocity_c[0])*this.steerAngle,W=Math.atan2(this.velocity_c[1]+p,Math.abs(this.velocity_c[0])),F=e.tireGrip,_=e.tireGrip*(1-this.input.eBrake*(1-e.lockGrip)),b=S(-e.cornerStiffnessFront*C,-F,F)*n,x=S(-e.cornerStiffnessRear*W,-_,_)*h,L=Math.min(this.input.brake*e.brakeForce+this.input.eBrake*e.eBrakeForce,e.brakeForce),T=this.input.throttle*e.engineForce,E=T-L*Math.sign(this.velocity_c[0]),I=0,Y=-e.rollResist*this.velocity_c[0]-e.airResist*this.velocity_c[0]*Math.abs(this.velocity_c[0]),X=-e.rollResist*this.velocity_c[1]-e.airResist*this.velocity_c[1]*Math.abs(this.velocity_c[1]),G=Y+E,N=X+I+Math.cos(this.steerAngle)*b+x;this.accel_c[0]=G/e.mass,this.accel_c[1]=N/e.mass,this.accel[0]=i*this.accel_c[0]-o*this.accel_c[1],this.accel[1]=o*this.accel_c[0]+i*this.accel_c[1],this.velocity[0]+=this.accel[0]*t,this.velocity[1]+=this.accel[1]*t,this.absVel=z(this.velocity);let A=(b+I)*e.cgToFrontAxle-x*e.cgToRearAxle;Math.abs(this.absVel)<.5&&!T&&(this.velocity[0]=this.velocity[1]=this.absVel=0,this.yawRate=A=0);const O=A/this.inertia;this.yawRate+=O*t,this.heading+=this.yawRate*t,this.position[0]+=this.velocity[0]*t,this.position[1]+=this.velocity[1]*t}doSteering(){const t=this.input.right-this.input.left;this.steer=t,this.steerAngle=this.steer*this.config.maxSteer}}const w=600,j=600;class J{constructor(){r(this,"x",0);r(this,"y",0);r(this,"zoom",20)}translate(t){return[(t[0]-this.x)*this.zoom+w/2,(t[1]-this.y)*this.zoom+w/2]}}const l=new J,v=[];for(let s=0;s<7;s++)v.push({radius:(2+Math.random()*10|0)*20,to:(Math.random()-.5)*.4});let f,u,P,m={pos:[0,0],angle:0};function Q(){f=new R({center:[0,0],radius:30,from:0,to:-.5,width:10});let s=f,t=0;for(;v.length>0;)t++,s=s.continue(v.pop()),t==1&&(m.pos=s.startPoint,m.angle=s.clockwise?(s.from+.5)*Math.PI:(s.from-.5)*Math.PI),t==5&&(u=s);P=s,[l.x,l.y]=f.endPoint}function U(s){let t=f;for(;t;)t.draw(s,l),t=t.next;s.fillStyle="lime",s.beginPath(),s.moveTo(w/2,j/2),s.stroke()}const g={},c={oldX:0,oldY:0,x:0,y:0,speedX:0,speedY:0,button:[]},y=document.getElementById("myCanvas"),d=y.getContext("2d");d.font="14px serif";let a;function B(){d.fillStyle="#CFFDBC",d.fillRect(0,0,600,600),c.button[0]&&(l.x+=c.speedX,l.y+=c.speedY),a.input.left=0,a.input.right=0,g.a&&(a.input.left=1),g.d&&(a.input.right=1),a.input.throttle=0,a.input.brake=0,g.w&&(a.input.throttle=1),g.s&&(a.input.throttle=0,a.input.brake=1),U(d),d.fillText(`${c.x} ${c.y}`,20,20);let[s,t]=a.position,e=s-l.x,o=t-l.y;l.x+=e*.2,l.y+=o*.2,l.zoom=(1-a.absVel/100)*20+5,a.update(1e3/60/1e3);let i=u.endPoint;e=i[0]-a.position[0],o=i[1]-a.position[1],Math.sqrt(e*e+o*o)<=f.width*1.2&&(f=f.next,u=u.next,P=P.continue({radius:(2+Math.random()*10|0)*20,to:Math.random()-.5})),a.draw(d,l),d.moveTo(...l.translate(a.position)),d.lineTo(...l.translate(u.endPoint)),d.stroke(),requestAnimationFrame(B)}document.addEventListener("DOMContentLoaded",function(){a=new K({}),Q(),a.position=m.pos,a.heading=m.angle,B()});y.addEventListener("mousemove",function(s){const t=y.getBoundingClientRect();c.oldX=c.x,c.oldY=c.y,c.x=s.clientX-t.left,c.y=s.clientY-t.top,c.speedX=c.x-c.oldX,c.speedY=c.y-c.oldY});y.addEventListener("mousedown",function(s){c.button[s.button]=!0});y.addEventListener("mouseup",function(s){c.button[s.button]=!1});document.addEventListener("keydown",s=>{g[s.key]=!0});document.addEventListener("keyup",s=>{g[s.key]=!1});

</script>
</head>
<body>
    <canvas id="myCanvas" width="600" height="600" ></canvas>
</body>
</html>
